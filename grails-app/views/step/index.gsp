<sec:ifAllGranted roles="ROLE_USER_LEADER">
<g:render template="/user/leader/navBar"/>
</sec:ifAllGranted>
<sec:ifNotGranted  roles="ROLE_USER_LEADER">
<g:render template="/user/user/navBar"/>
</sec:ifNotGranted>

<div class="content-wrapper">
	<!-- Main content -->
	<section class="content"  id="principalSection">
		<!-- Small boxes (Stat box) -->
		<sec:ifAllGranted roles="ROLE_USER_LEADER">
			<g:render template="/user/leader/boxes-1"/>
		</sec:ifAllGranted>
		<sec:ifNotGranted  roles="ROLE_USER_LEADER">
			<g:render template="/user/user/boxes-1"/>
		</sec:ifNotGranted>
<!-- /.row -->
<!-- Main row -->

			<div class="row">
				<div class="col-xs-12">
					<div class="nav-tabs-custom">
			<!-- Tabs within a box -->
						<ul class="nav nav-tabs pull-right">
							<li class="active">
								<a href="#revenue-chart" data-toggle="tab">
									<i class="fa fa-list-alt" style="color: blue"> </i> <g:message code="text.steps" />
								</a>
							</li>
							<sec:ifAnyGranted roles="${functionality12.roles}">
								<li>
									<a href="#newStep-chart" data-toggle="tab">
										<i class="fa fa-plus" style="color: green"></i> <g:message code="text.new" />
									</a>
								</li>
							</sec:ifAnyGranted>
							<sec:ifAnyGranted roles="${functionality17.roles}">
								<li>
									<g:if test="${associatedScenario.isWeb() || associatedScenario.type == 2}" >
										<a href="#" onclick="showBrowsers(${associatedScenario.id}); return false;">
											<i class="fa fa-play-circle-o" style="color: green"></i> 
											<g:message code="text.execute" />
										</a>
									</g:if>
									<g:else>
										<a href="#"onclick="executeScenario(${associatedScenario.id}); return false;">
											<i class="fa fa-play-circle-o" style="color: green"></i> 
											<g:message code="text.execute" />
										</a>
									</g:else>
								</li>
							</sec:ifAnyGranted>
							<li class="pull-left header">
								<i class="fa fa-inbox"> </i> <g:message code="text.steps" />
							</li>
						</ul>

						<div class="tab-content no-padding">
							<!-- Morris chart - Sales -->
							<div class="chart tab-pane active" id="revenue-chart"
							style="position: relative;">
								<div class="box">
									<div class="box-header col-md-12">
										<div class="col-md-6">
											<h3>
												<i class="fa  fa-sort-amount-desc"> </i>
												<g:message code="text.steps"/>
											</h3>
										</div>
										<div class="col-md-6">
											<ol class="breadcrumb pull-right" style="background-color:white">
												<li><g:link controller='user' action='renderIndex'><g:message code="general.home"/></g:link></li>
									        	<li><g:link controller='project' action='index'>${associatedScenario.project.name}</g:link></li>
									       		<li><g:link controller='scenario' action='index' id='${associatedScenario.project.id}'>${associatedScenario.name}</g:link></li>
									       		<li class="active"><g:message code="text.steps"/></li>
									    	</ol>
										</div>
										
									</div>
									<!-- /.box-header -->
									<div class="box-body row">
										<div class="col-md-3" style="z-index:98">
											<label for="pagesSelect">
												<g:message code="text.page"/>:
											</label>
											<select class="form-control" id="pagesSelect">
												<g:each status="i" var="page" in="${pages}">
													<option  value="${page.id}">
														${page.name}
													</option>
												</g:each>
											</select>
											<br>
											<g:if test="${pages.size()>0}">
											<g:if test="${pages.getAt(0).getObjects().sort{it.dateCreated}.findAll{!it.autoGenerated}.size()>0}">
												<label class="form-control" id="selectAllLabel">
													<g:message code="general.text.selectAll" />
													<input id="selectAllObjects" type="checkbox" class="ios-switch objectSwitch " /><div class="switch pull-right"></div>
												</label>
											</g:if>

												<table class="table table-bordered table-condensed table-hover  paginated" id="sObjectsTable">
													<tbody  id="selectable">

														
														<g:each in="${pages.getAt(0).getObjects().sort{it.dateCreated}.findAll{!it.autoGenerated && it.isValid(associatedScenario.type)}}" var="obj">
															<tr idObj="${obj.id}" class="trSelectable" select="0">
																<td style="border:solid 1px  #ccccb3;" >
																		${obj.name}
																</td>
																<td style="border:solid 1px  #ccccb3;" >
																	<img  class="zoomImage" style="max-height:50px; max-width:150px" original="" src="${createLink(controller: 'stage', action:'renderImage', params:[idOb:obj.imageUrl])}" />
																</td>
															</tr>
														</g:each>
													</tbody>
												</table>
												<label class="form-control" id="">
													<g:message code="general.text.selectAll" />
													<input id="selectAllObjectsAuto" type="checkbox" class="ios-switch objectSwitch " /><div class="switch pull-right"></div>
												</label>
												<table class="table table-bordered table-condensed table-hover  paginated" id="sObjectsTableAuto">
													<tbody  id="selectable">
														<g:each in="${pages.getAt(0).getObjects().sort{it.dateCreated}.findAll{it.autoGenerated && it.isValid(associatedScenario.type)}}" var="obj">
															<tr idObj="${obj.id}" class="trSelectable autoGenerated" select="0">
																<td style="border:solid 1px  #ccccb3;" >
																	${obj.name}
																</td>
																<td style="border:solid 1px  #ccccb3;" >
																	<img  class="zoomImage" style="max-height:50px; max-width:150px" original="" src="${createLink(controller: 'stage', action:'renderImage', params:[idOb:obj.imageUrl])}" />
																</td>
															</tr>
														</g:each>
													</tbody>
												</table>
											</g:if>
										</div>
										<div class="col-md-1">
											<br><br><br>
											<g:each  var="i" in="${ (0..<steps.size()*5/6) }">
												<br>
											</g:each>


											<div  class="icon caretButton" style="color:green; margin-left:20%; cursor:pointer;">
												<i  class="fa   fa-angle-double-right fa-5x"></i>
												<br/>
											</div>
										</div>

										<div class="col-md-8 row" style="overflow:auto; padding-right:0px">
											<div class="col-md-5">
												<label> <g:message code="datatable.showing"/></label> 
												<select id="rowsPerPageSelect" >
													<option value="10">10</option>
													<option value="25">25</option>
													<option value="50">50</option>
													<option value="100">100</option>
												</select>
												<label style="margin-right:45px"> 
													<g:message code="datatable.entries"/>
												</label>
											</div>
											<div class="col-md-1" style="padding-right:0px">
												<label for="search" class="pull-right">
													<g:message code="datatable.search"/>: 
												</label>
											</div>
											<div class="col-md-6">
												<input id="datatablesearch" table="stepsTable" name="search" type="text" class="form-control pull-left"></input>
											</div>
											
											<div class="row col-md-12" style="margin-bottom:10px; margin-top:10px; margin-right:0px; padding-right:0px">
												<button class="btn btn-danger pull-right" id="deleteSelection" ><g:message code="text.delete" /> <i class="fa fa-trash"></i></button>
												<label style="margin-top:8px; padding-right:14px;" class="pull-right">
													<g:message code="general.text.selectAll" />
													<input id="selectAllRowsSwitch" class="ios-switch"  type="checkbox">
													<div class="switch"></div>
												</label>												
											</div>
											<table id="stepsTable" class="table table-bordered table-condensed table-hover sortable paginated">
												<thead>
													<tr>
														<th><g:message code="text.order" /></th>
														<th><g:message code="text.type" /></th>
														<th><g:message code="text.object" /></th>
														<th><g:message code="text.referenceImage" /></th>
														<th><g:message code="text.principalAction" /></th>
														<th><g:message code="text.supportActions" /></th>
														<sec:ifAnyGranted roles="${functionality13.roles}">
															<th><label style="text-align:center;" class="pull-right">
																	<g:message code="general.text.activateAll" />
																	<input id="selectAllSwitch" class="ios-switch"  type="checkbox">
																	<div class="switch"></div>
																</label>
															</th>														
															<th><g:message code="text.edit" /></th>
															<th><g:message code="text.delete" /></th>
														</sec:ifAnyGranted>
													</tr>
												</thead>
												<tbody>
													<g:each status="i" in="${steps}" var="step">
														<tr id="${step.id}" class="jquerySortable trSelectableSteps autoGenerated" select="0">
															<td class='priority'>
																${i+1}
															</td>
															<td>
																<g:if test="${step.pType==1}">
																	<span id="stepType${step.id}" class="label label-success">WEB</span>
																</g:if>
																<g:elseif test="${step.pType==2}">
																	<span id="stepType${step.id}"  class="label label-info">GUI</span>
																</g:elseif>
																<g:elseif test="${step.pType==3}">
																	<span id="stepType${step.id}" class="label label-warning">CLI</span>
																</g:elseif>
																<g:elseif test="${step.pType==4}">
																	<span id="stepType${step.id}" class="label label-danger">UFT</span>
																</g:elseif>
																<g:elseif test="${step.pType==5}">
																	<span id="stepType${step.id}" class="label" style="background-color:#8b6ecc">RFT</span>
																</g:elseif>
															</td>
															<td>
																<g:if test="${step.object==null || step.object.autoGenerated}" >
																	<a href='#' id="objectModal${step.id}"  onclick="return false;">--</a>
																	<g:if test="${step.mustTakeScreenShot}">
																		<i id="camera${step.id}" class="fa fa-camera" style="display:block"></i>
																	</g:if>
																	<g:else>
																		<i id="camera${step.id}" class="fa fa-camera" style="display:none"></i>
																	</g:else>
																</g:if>
																<g:else>
																	<a href='#' id="objectModal${step.id}" onclick='showEditObjectModal(${step.object.id},"${step.object.name}","${step.object.allTargets.split('#;#')[1]}","${step.object.allTargets.split('#;#')[0]}"); return false;'>${step.object.name} </a>
																	<g:if test="${step.mustTakeScreenShot}">
																		<i id="camera${step.id}" class="fa fa-camera" style="display:block"></i>
																	</g:if>
																	<g:else>
																		<i id="camera${step.id}" class="fa fa-camera" style="display:none"></i>
																	</g:else>
																</g:else>
															</td>
															<td>
																<g:if test="${step.object==null}" >
																<img  class="zoomImage" id="referenceImage${step.id}" style="max-height:50px; max-width:150px"original="" src="${createLink(controller: 'stage', action:'renderImage', params:[idOb:'noImage'])}" />
																</g:if>
																<g:else>
																	<img  class="zoomImage" id="referenceImage${step.id}" style="max-height:50px; max-width:150px"original="" src="${createLink(controller: 'stage', action:'renderImage', params:[idOb:step.object.imageUrl])}" />
																</g:else>
															</td>

															<g:if test="${step.object==null}" >
																<td>
																	<small class="label bg-blue" id="editSmall${step.id}" mustTakeScreenShot="${step.mustTakeScreenShot}" mustTakeLocalScreenShot="${step.mustTakeLocalScreenShot}" isEnabled="${step.isEnabled}" isMasive="${step.isMasive}" forceCoordinates="${step.forceCoordinates}" object="null" page="null" principalAction="${step.principalAction.action.id}" supportActions="${step.getSupportActionsByOrder().encodeAsJSON()}" principalValue="${step.principalAction.value}" supportValues="${step.getSupportActionsValue()}" isHidden="${step.isHidden}" pType="${step.pType}" onclick='showEditStepModal(${step.id}); return false;' style="cursor:pointer"><g:message code="${step.principalAction.action.name}"/></small >
																</td>
															</g:if>
															<g:else>
																<td>
																	<small class="label bg-blue" id="editSmall${step.id}" mustTakeScreenShot="${step.mustTakeScreenShot}" mustTakeLocalScreenShot="${step.mustTakeLocalScreenShot}" isEnabled="${step.isEnabled}" isMasive="${step.isMasive}" forceCoordinates="${step.forceCoordinates}" object="${step.object.id}" page="${step.object.page.id}" principalAction="${step.principalAction.action.id}" supportActions="${step.getSupportActionsByOrder().encodeAsJSON()}" principalValue="${step.principalAction.value}" supportValues="${step.getSupportActionsValue()}" isHidden="${step.isHidden}" pType="${step.pType}" onclick='showEditStepModal(${step.id}); return false;' style="cursor:pointer"><g:message code="${step.principalAction.action.name}"/></small>
																</td>
															</g:else>

															<td id="tdsupport${step.id}" style="white-space:wrap;" class="col-md-12 col-xs-12">
																<g:each in="${step.getSupportActionsByOrder()}"
																var="action" status="k">
																<g:if test="${k%2==0}">
																	<small class="label label-success col-md-5 col-xs-5 col-sm-5" style="margin-top:1px; margin-bottom:1px;" id="${action.id}">
																</g:if>
																<g:else>
																	<small class="label label-success col-md-5  col-xs-5 col-sm-5 " style="margin-top:1px; margin-bottom:1px; margin-left:3px; margin-right:1px;" id="${action.id}" >
																</g:else>
																<g:if test="${message(code:action.name).trim().length()>10}">${message(code:action.name).substring(0,7)}...
																</g:if>
																<g:else>
																	<g:message code="${action.name}" />
																</g:else>
																</small>
																</g:each>
															</td>

															<td>
																<g:if test="${step.isEnabled}">
																	<label>
																		<input
																		id="${step.id}" type="checkbox"
																		class="ios-switch enabledcheck" checked/><div class="switch"></div>
																	</label>
																</g:if>
																<g:else>
																	<label><input id="${step.id}" type="checkbox" class="ios-switch enabledcheck" /><div class="switch"></div>
																	</label>
																</g:else>
															</td>
															<sec:ifAnyGranted roles="${functionality13.roles}">
																<td>
																	<g:if test="${step.object==null}" >
																
																	<a href="#" onclick='showEditStepModal(${step.id}); return false;' style="cursor:pointer">
																		<i class="fa fa-pencil-square-o "> </i></a>
																	</g:if>
																	<g:else>

																	<a href="#" onclick='showEditStepModal(${step.id}); return false;' >
																		<i class="fa fa-pencil-square-o "> </i></a>
																	</g:else>
																</td>
																<td>
																	<a style="color:red;" href="#"
																	onclick="setDeletingId(${step.id}); return false;"><i
																	class="fa fa-trash-o"> </i></a>
																</td>
															</sec:ifAnyGranted>
														</tr>	
													</g:each>
												</tbody>
											</table>
										</div>
									</div>
									<!-- /.box-body -->
								</div>
								<!-- /.box -->
							</div>


							<div class="chart tab-pane" id="newStep-chart" style="position: relative;">

								<div id="formNewStep" style="margin-left: 20px; margin-right: 20px;">
									<label for="pagesSelectNewStep"><g:message code="text.page"/></label>
									<select class="form-control" id="pagesSelectNewStep">
										<option id="null" value="null"></option>
										<g:each status="i" var="page" in="${pages}">
											<option id="${page.id}" value="${i}">
												${page.name}
											</option>
										</g:each>
									</select>
									<br/>
									<label for="objectsDropdown">
									<g:message code="text.object" /></label> 
									<select  class="form-control" id="objectsDropdown">
										<option value="null"></option>
										
										
									</select>
									<br>


								


									<label for="actionsDropdown"><g:message code="text.principalAction" /></label>
									<div  class="btn-group" style="width:100%">
									  <button type="button" class="btn btn-default select-dropdown-principal-button" style="" data-toggle="dropdown" onclick="$('.dropdown-toggle').dropdown('actionsDropdown')"><label id="firstActionsLabel"style="width:80%" ></label><label id="lastActionsLabel" class="label label-info" style="width:12%"></label></button>
									  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  style="width:3%; padding-right:2px; padding-left:2px;  background-color: #E1E1E1; border-color:#ADADAD;" id="ActionsDropdownBtn">
									    <span class="caret"></span>
									  </button>
									  <ul class="dropdown-menu select-dropdown-ul" id="actionsDropdown" value="">
									   		<g:each status="i" var="action" in="${actions.sort{message(code:it.name)}}">
												<g:if test="${!action.needsObject}">
													<g:if test="${associatedScenario.type == 1}">
														<g:if test="${action.platform.contains('WEB') || action.platform.contains('GUI') || action.platform.contains('CLI')}">															
															<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>															
														</g:if>
													</g:if>
													<g:elseif test="${associatedScenario.type == 2}">
														<g:if test="${action.platform.contains('UFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}">
															<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>
														</g:if>
													</g:elseif>
													<g:elseif test="${associatedScenario.type == 3}">
														<g:if test="${action.platform.contains('RFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}">
															<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>
														</g:if>
													</g:elseif>
												</g:if>
											</g:each>
									  </ul>
									</div>
									<br> 
									<br> 
									<div id="supportActionsDiv" style="display:none">
										<label for="supportActions">
											<g:message	code="text.supportActions" />
										</label>
										<div id="notSupportActionsAdded" class="row" >
											<label class="col-md-4 col-md-offset-4" style="color:#999966 "><g:message code="text.notSupportActions"/></label>
										</div>
										<ul class="todo-list " id="supportActions">
										</ul>
										<br>
										<label id="newNotPosibleToAdd" class="label label-danger"style="display:none"><g:message code="text.notPosibleToAddSupportAction"/></label>
											<div  class="btn-group" style="width:100%">
											  <button type="button" class="btn btn-default select-dropdown-principal-button" style="min-height:34px" data-toggle="dropdown" onclick="$('.dropdown-toggle').dropdown('selectSupportActions')"><label id="firstSupportActionsLabel"style="width:80%; " ></label><label id="lastSupportActionsLabel" class="label label-info" style="width:12%"></label></button>
											  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  style="width:3%; padding-right:2px; padding-left:2px;  background-color: #E1E1E1; border-color:#ADADAD;" id="supportActionsDropdownBtn">
											    <span class="caret"></span>
											  </button>
											  <ul class="dropdown-menu select-dropdown-ul" id="selectSupportActions" value="">
											  <li class="select-dropdown-li"  platform="" id="" customhtml='' value=""><a href="#" onclick="changeSupportActions(this); return false;"><label class="select-dropdown-li-first"></label><label class="label label-info select-dropdown-li-last" ></label></a></li>	
											   		<g:each status="i" var="action" in="${actions.sort{message(code:it.name)}}">
														<g:if test="${associatedScenario.type == 1}">
															<g:if test="${action.platform.contains('WEB') || action.platform.contains('GUI') || action.platform.contains('CLI')}">										
																<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changeSupportActions(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>		
															</g:if>
														</g:if>
														<g:elseif test="${associatedScenario.type == 2}">
															<g:if test="${action.platform.contains('UFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}">
																<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changeSupportActions(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>
															</g:if>
														</g:elseif>
														<g:elseif test="${associatedScenario.type == 3}">
															<g:if test="${action.platform.contains('RFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}">
																<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}' value="${message(code:action.name)}"><a href="#" onclick="changeSupportActions(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>
															</g:if>
														</g:elseif>
													</g:each>
											  </ul>
											</div>
											<button style="margin-top: 3px;" id="addSupportActionButton" class="btn btn-default pull-right" onclick="addNewSupportAction('#supportActions'); return false;">
											<i class="fa fa-plus"></i>
											<g:message code="text.add" />
											</button>
										



									</div>
									<br> 

									<label for="stepType"><g:message code="text.stepType"/></label>
									<select class="form-control" id="stepType">
										<g:if test="${associatedScenario.type == 1}">
											<option  value="1" >
												WEB
											</option>
										</g:if>
										<g:elseif test="${associatedScenario.type == 3}">
											<option  value="5" >
												RFT
											</option>
										</g:elseif>
										<g:elseif test="${associatedScenario.type == 2}">
											<option  value="4" >
												UFT
											</option>
										</g:elseif>
										<option  value="2">
											GUI
										</option>
										<option  value="3">
											CLI
										</option>

									</select>

									<br> <br> 
									<table class="table table-bordered table-condensed " style="border:1px solid #AAA">
										<thead>
											<tr>
												<th style="border:1px solid #D2D6DE"><g:message code="text.isEnabled" /></th>
												<th style="border:1px solid #D2D6DE"><g:message code="text.mustTakeScreenshot" /></th>
												<th style="border:1px solid #D2D6DE"><g:message code="text.mustTakeLocalScreenshot" /></th>
												<th style="border:1px solid #D2D6DE"><g:message code="text.forceCoordinates" /></th>
												<th style="border:1px solid #D2D6DE"><g:message code="text.isHidden" /></th>
												<th style="border:1px solid #D2D6DE"><g:message code="text.isMasive" /></th>
												
											</tr>
										</thead>
										<tbody>
											<tr style="border:1px solid #D2D6DE">
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="enabled" type="checkbox" class="ios-switch objectSwitch" checked/><div class="switch"></div></label>
												</td>
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="mustTakeScreenshot" type="checkbox"
													class="ios-switch " /><div class="switch"></div></label>
												</td>
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="mustTakeLocalScreenshot" type="checkbox"
													class="ios-switch " /><div class="switch"></div></label>
												</td>
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="forceCoordinates" type="checkbox"
													class="ios-switch objectSwitch" /><div class="switch"></div></label>
												</td>
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="isHidden" type="checkbox" class="ios-switch objectSwitch"/><div class="switch"></div></label>
												</td>
												<td style="border:1px solid #D2D6DE; ">
													<label class=""><input id="isMasive" type="checkbox"
													class="ios-switch objectSwitch" /><div class="switch"></div></label>
												</td>
												
											</tr>

										</tbody>
											
									</table>
									<br>
									<div id="masiveHtml" class="col-md-6" style="background-color: #E0E0EB">
									</div>


									<br>
									<div class="col-md-12">
										<button type="button" id="formNewStepButton" style="margin-bottom: 30px"
										class="btn btn-info pull-right">
											<g:message code="general.text.save" />
										</button>
									</div>
								</div>
								<br> <br>
								<div style="display: none" id="loadingState" class="overlay">
									<i class="fa fa-refresh fa-spin"></i>
								</div>
							</div>
							<!--New step chart -->
							<div class="chart tab-pane" id="addScenario-chart" style="position: relative;">
							<div class="box">
								<div class="box-header">
									<h3><i class='fa fa-life-ring'></i><g:message code="text.supportScenario"/><h3>
								</div>
								<div class="box-body">
									<p><g:message code="help.supportScenario.message"/></p>
									<select id="addScenarioSelect" class="form-control">
										<g:each in="${scenarios}" var="scenario">
											<g:if test="${scenario.id != scenarioId}">
												<option value="${scenario.id}">${scenario.name}</option>
											</g:if>
											
										</g:each>
									</select>
									<br/>
									
									<table>
										<tr style="margin-top:3px">
											<td>
												<label class=""><g:message code="text.isHidden"/></label>
											</td>
											<td style="padding-left:30px">
												<label class=""><input id="supportScenarioIsHidden" type="checkbox" class="ios-switch objectSwitch"/><div class="switch"></div></label>
											</td>
										</tr>
										<tr style="margin-top:3px">
											<td>
												<label class=""><g:message code="text.isMasive"/></label>
											</td>
											<td style="padding-left:30px">
												<label class=""><input id="supportScenarioIsMasive" type="checkbox" class="ios-switch objectSwitch" /><div class="switch"></div></label>
											</td>
										</tr>
									</table>
									<br/>
									
									


									<button type="button" id="addScenarioButton" style="margin-bottom: 30px"
										class="btn btn-info pull-right">
											<g:message code="general.text.continue" />
									</button>
								</div>
							</div>
								
							</div>
						</div>
					</div>
				<!-- /.col -->
				</div>
			</div>
			<!-- /.row -->
	</section>
	<!-- /.content -->
</div>
<!-- ./wrapper -->


<sec:ifAllGranted roles="ROLE_USER_LEADER">
<g:render template="/user/leader/footer"/>
</sec:ifAllGranted>
<sec:ifNotGranted  roles="ROLE_USER_LEADER">
<g:render template="/user/user/footer"/>
</sec:ifNotGranted>



<div id="modalAndJsSection">

	<!-- Modal de edición de step -->
	<div id="editStepModal" class="modal fade" role="dialog" >
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content" style="overflow-y: auto;">

				<div class="modal-header alert-info">
					<h3>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<g:message code="text.edit" />
						<g:message code="text.step" />
					</h3>
				</div>
				<div class="modal-body">
					<br>
					<div id="formEditStep"
					style="margin-left: 20px; margin-right: 20px; margin-bottom:30px;">
					<label for="editPagesSelectStep"><g:message code="text.page"/></label>
					<select class="form-control" id="editPagesSelectStep">
						<g:each status="i" var="page" in="${pages}">
						<option value="${page.id}">
							${page.name}
						</option>
					</g:each>
				</select>
				<br/>
				<label for="editObjectsDropdown"><g:message
					code="text.object" /></label> <select  class="form-control"
					id="editObjectsDropdown">
					<option value="null" name="--" imageUrl="noImage"></option>
					<g:if test="${pages.size()>0}">
						<g:each status="j" var="object" in="${pages[0].objects}">
							<g:if test="${object.autoGenerated}">
								<option style="color:#555" id="${object.id}" value="${object.id}" imageUrl="${object.imageUrl}" name="${object.name}" typeOfMap="${object.allTargets}" idObj="${object.allTargets}">
									${object.name}
								</option>
							</g:if>
							<g:else>
								<option style="color:#555" id="${object.id}" value="${object.id}" imageUrl="${object.imageUrl}" name="${object.name}" typeOfMap="${object.allTargets.split('#;#')[1]}" idObj="${object.allTargets.split('#;#')[0]}">
									${object.name}
								</option>
							</g:else>
						</g:each>
					</g:if>
		</select> <br>




		<label for="editActionsDropdown"><g:message code="text.principalAction" /></label>
			<div  class="btn-group" style="width:100%">
			  <button type="button" class="btn btn-default select-dropdown-principal-button" style="" data-toggle="dropdown" onclick="$('.dropdown-toggle').dropdown('editActionsDropdown')"><label id="firstEditActionsLabel"style="width:80%" ></label><label id="lastEditActionsLabel" class="label label-info" style="width:12%"></label></button>
			  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  style="width:3%; padding-right:2px; padding-left:2px;  background-color: #E1E1E1; border-color:#ADADAD;" id="editActionsDropdownBtn">
			    <span class="caret"></span>
			  </button>
			  <ul class="dropdown-menu select-dropdown-ul" id="editActionsDropdown" value="">
			   		<g:each status="i" var="action" in="${actions.sort{message(code:it.name)}}">
						<g:if test="${!action.needsObject}">						
							<g:if test="${associatedScenario.type == 1}">
								<li id="${action.id}" value="${createLink(code:action.name)}" class="select-dropdown-li" customhtml='${action.html.replace('replaceForCode',message(code:action.name))}'><a href="#" onclick="return false;" >
									<g:message code="${action.name}" /><label class="label label-info">${action.platform}</label>
									</a>
								</li>
							</g:if>
						</g:if>
					</g:each>
			  </ul>
			</div>
		<br> 







	</br>
	<div id="editSupportActionsDiv" style="display:none">
			<label for="editSupportActions"><g:message code="text.supportActions" /></label>
			<br/>
			<div id="editNotSupportActionsAdded" class="row" style="display:none">
				<label class="col-md-4 col-md-offset-4" style="color:#999966 "><g:message code="text.notSupportActions"/></label>
			</div>
			
			<ul class="todo-list " id="editSupportActions" style="margin-bottom:10px">
			</ul>
			<label id="notPosibleToAdd" class="label label-danger"style="display:none"><g:message code="text.notPosibleToAddSupportAction"/></label>
			<div  class="btn-group" style="width:100%; ">
			  <button type="button" class="btn btn-default select-dropdown-principal-button" style="min-height:34px" data-toggle="dropdown" onclick="$('.dropdown-toggle').dropdown('editSelectSupportActions')"><label id="firstEditSupportActionsLabel"style="width:80%" ></label><label id="lastEditSupportActionsLabel" class="label label-info" style="width:12%"></label></button>
			  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  style="width:3%; padding-right:2px; padding-left:2px;  background-color: #E1E1E1; border-color:#ADADAD;" id="editSupportActionsDropdownBtn">
			    <span class="caret"></span>
			  </button>
			  <ul class="dropdown-menu select-dropdown-ul" id="editSelectSupportActions" value=""  style="margin-bottom:10px">
			  		<li class="select-dropdown-li"  value="" ></li>
			   		<g:each status="i" var="action" in="${actions.sort{message(code:it.name)}}">
							<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='${action.html.replace("replaceForCode",message(code:action.name))}'value="${message(code:action.name)}"><a href="#" onclick="changeEditSupportAction(this); return false;"><label class="select-dropdown-li-first">${message(code:"${action.name}")}</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>
					</g:each>
			  </ul>
			</div>
			<button style="margin-top: 3px;" id="editAddSupportActionButton" class="btn btn-default pull-right" onclick="addSupportAction('#editSupportActions'); return false;">
			<i class="fa fa-plus"></i>
			<g:message code="text.add" />
			</button>
		<br> 
	</div>


</br>
</br>




	<!--<div id="editSupportActionsDiv" style="display:none">
	<br>
		<label for="editSupportActions"><g:message
			code="text.supportActions" /></label>
			<ul class="todo-list " id="editSupportActions">
			</ul>
			
			<label id="notPosibleToAdd" class="label label-danger"style="display:none"><g:message code="text.notPosibleToAddSupportAction"/></label>
			<div class="form-group">
				<select class="form-control" class="" id="editSelectSupportActions">
					<g:each status="i" var="action" in="${actions}">
					<option id="action${action.id}" value="${action.id}" customhtml='${action.html.replace('replaceForCode',message(code:action.name))}'>
						<g:message code="${action.name}"/>(${action.platform})
					</option>
				</g:each>
			</select>
			<button style="margin-top: 3px;" id="editAddSupportActionButton"
			class="btn btn-default pull-right"
			onclick="addSupportAction('#editSupportActions','#editSelectSupportActions'); return false;">
			<i class="fa fa-plus"></i>
			<g:message code="text.add" />
		</button><br/>
		</div>
	</div>
	<br> 

-->
</br>
	<label for="editStepType"><g:message code="text.stepType"/></label>
		<select class="form-control" id="editStepType">
			<g:if test="${associatedScenario.type == 1}">
				<option  value="1" >
					WEB
				</option>
			</g:if>
			<g:elseif test="${associatedScenario.type == 3}">
				<option  value="5" >
					RFT
				</option>
			</g:elseif>
			<g:elseif test="${associatedScenario.type == 2}">
				<option  value="4" >
					UFT
				</option>
			</g:elseif>
			<option  value="2">
				GUI
			</option>
			<option  value="3">
				CLI
			</option>
		</select>
	<br/>

	<table>
		<tr style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.isEnabled" /></label>
			</td>
			<td style="padding-left:30px">
				<label><input id="editEnabled" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>
		<tr style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.mustTakeScreenshot" /></label>
			</td>
			<td style="padding-left:30px">
				<label><input id="editMustTakeScreenshot" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>

		<tr  style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.mustTakeLocalScreenshot" /></label>
			</td>
			<td style="padding-left:30px">
				<label class=""><input id="editMustTakeLocalScreenshot" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>

		<tr  style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.forceCoordinates" /></label>
			</td>
			<td style="padding-left:30px">
				<label class=""><input id="editForceCoordinates" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>

		<tr  style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.isHidden" /></label>
			</td>
			<td style="padding-left:30px">
				<label class=""><input id="editIsHidden" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>

		<tr  style="margin-top:3px">
			<td>
				<label class=""><g:message code="text.isMasive" /></label>
			</td>
			<td style="padding-left:30px">
				<label class=""><input id="editIsMasive" type="checkbox" class="ios-switch " /><div class="switch"></div></label>
			</td>
		</tr>

		
	</table>
		
					<br>

					<div id="editMasiveHtml" class="col-md-6" style="background-color: #E0E0EB">
					</div>
					<br>
				<br><br>
			</div >
		</div>
	</div>
	

	</div>
	</div>

	<!-- fin del modal de edición de step -->



	<!-- Modal de confirmación de borrado de step -->
	<div id="confirmModal" class="modal fade " role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header alert-warning">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.text.confirmTitle" />
					</h4>
				</div>
				<div class="modal-body">
					<p>
						<g:message code="general.text.confirmMessage" />
					</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<g:message code="general.text.cancel" />
					</button>
					<button type="button" class="btn btn-warning "
					onclick="deleteStep()">
					<g:message code="general.text.continue" />
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Final del modal de confirmación -->

	<!-- Modal de confirmación de borrado masivo de step -->
	<div id="masiveDeleteConfirmModal" class="modal fade " role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header alert-warning">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.text.confirmTitle" />
					</h4>
				</div>
				<div class="modal-body">
					<p>
						<g:message code="general.text.confirmMessage" />
					</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<g:message code="general.text.cancel" />
					</button>
					<button type="button" class="btn btn-warning "
					onclick="masiveDeleteStep()">
					<g:message code="general.text.continue" />
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Final del modal de confirmación de borrado masivo de step -->

	<!-- Modal de edición del objeto de paso -->
	<div id="editObjectModal" class="modal fade " role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header alert-info">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="text.edit" /> <g:message code='text.object'/>
					</h4>
				</div>
				<div class="modal-body">
					<div>
						<label for="editObjectName">
							<g:message  code="text.name"/>
						</label>
						<input class="form-control" id="editObjectName" type="text"/>
						<br/>
						<label for="editObjectTypeOfMap">
							<g:message  code="text.typeOfMap"/>
						</label>
						<input class="form-control" id="editObjectTypeOfMap" type="text"/>
						<br/>
						<label for="editObjectId">
							<g:message  code="text.objectId"/>
						</label>
						<input class="form-control" id="editObjectId" type="text"/>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<g:message code="general.text.cancel" />
					</button>
					<button type="button" class="btn btn-info "
					onclick="editObject()">
					<g:message code="general.text.save" />
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Final del modal de edición del objeto del paso  -->



	<!-- Modal de expiración de sesión  -->
	<div id="expiredSessionModal" class="modal fade " role="dialog">
		<div class="modal-dialog">
			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header alert-warning">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.text.expiredSessionTitle" />
					</h4>
				</div>
				<div class="modal-body">
					<p id="expiredSessionAlert">
						<g:message code="general.text.expiredSessionText" />
					</p>
				</div> 
			</div>
		</div>
	</div>
	<!-- Fin del modal de expiración de sesión-->






	<!-- Modal de exito para ejecucion -->
	<div id="executionSuccessModal" class="modal fade " role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header alert-success">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.success" />
					</h4>
				</div>
				<div class="modal-body">
					<p id="executionSuccessMessage"></p>
				</div>
			</div>
		</div>
	</div>
	<!-- Fin del modal deexito para ejecuciones -->

		<!-- Modal de error -->
	<div id="newStepErrorModal" class="modal fade " role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header alert-danger">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.error" />
					</h4>
				</div>
				<div class="modal-body">
					<p id="newStepErrorMessage"></p>
				</div>
			</div>
		</div>
	</div>
	<!-- Fin del modal deexito para ejecuciones -->



	<!-- Modal de error para ejecuciones -->
	<div id="executionErrorModal" class="modal fade " role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header alert-error">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="general.error" />
					</h4>
				</div>
				<div class="modal-body">
					<p id="executionErrorMessage"></p>
				</div>
			</div>
		</div>
	</div>
	<!-- Fin del modal de error para ejecuciones -->






	<!-- Modal de selección de navegador  -->

	<div id="browserSelectionModal" class="modal fade " role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header alert-info">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					
					<h4 class="modal-title">
						<g:message code="text.browserSelection" />
					</h4>
				</div>
				<div class="modal-body">
						<div class="row col-md-12">
								<div class="col-md-2 col-xs-4" id="divch">
									<asset:image src="browsers/ch.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checkch" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
							
								<div class="col-md-2 col-xs-4" id="divff">
									<asset:image src="browsers/ff.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checkff" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
								<div class="col-md-2 col-xs-4" id="divie">
									<asset:image src="browsers/ie.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checkie" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
								<div class="col-md-2 col-xs-4" id="divsa">
									<asset:image src="browsers/sa.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checksa" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
								<div class="col-md-2 col-xs-4" id="dived">
									<asset:image src="browsers/ed.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checked" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
								<div class="col-md-2 col-xs-4" id="divop">
									<asset:image src="browsers/op.png" height='50px' style="margin-left:10px; margin-bottom:3px;"/>
									<label><input id="checkop" class="ios-switch objectSwitch" type="checkbox">
														<div class="switch"></div></label>
								</div>
						</div>
						<br>
						<br>
						<br>
						<br>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<g:message code="general.text.cancel" />
					</button>
					<button type="button" class="btn btn-info"
						onclick="executeWebScenario()">
						<g:message code="general.text.continue" />
					</button>
				</div>
			</div>

		</div>
	</div>
	<!-- Fin del modal de selección de navegador-->




	<!-- Modal de confirmación de forzado de la ejecución -->
	<div id="forceExecutionModal" class="modal fade " role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header alert-warning">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">
						<g:message code="text.attention" />
					</h4>
				</div>
				<div class="modal-body">
					<p>
						<g:message code="text.forceExecution.message" />
					</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<g:message code="general.text.cancel" />
					</button>
					<button type="button" class="btn btn-warning "
						onclick="forceExecution()">
						<g:message code="general.text.continue" />
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- Final del modal de confirmación -->



	<asset:javascript src="zoom.js"/>

	<script>
		var editingId=null;
		var deletingId = null;
		var stepsToDelete = "";
		var currentPage = 0;
		var numPerPage = 10;
		var editPrincipalHtml=""
		var objectEditingId=null
		var editPrincipalValues
		var userBrowsers = "${browsers}"
		var mustUpdate=false
		var curExecutionRequestId = null

		var fixHelperModified = function(e, tr) {
			var $originals = tr.children();
			var $helper = tr.clone();
			$helper.children().each(function(index)
			{
			  $(this).width($originals.eq(index).width())
			});
			return $helper; 
		};


		$('#rowsPerPageSelect').change(function(){
			numPerPage = $(this).val()
			$('.pager').remove()
			makeTablePaginated()
		}); 


		//Renumber table rows
		function renumber_table(tableID) {
			$(tableID + " tr").each(function() {
				count = $(this).parent().children().index($(this)) + 1;
				$(this).find('.priority').html(count);
			});
			
		}


		function showEditObjectModal(id,name,typeOfMap,objId){
			objectEditingId=id
			$('#editObjectName').val(name)
			$('#editObjectTypeOfMap').val(typeOfMap)
			$('#editObjectId').val(objId)
			$('#editObjectModal').modal('show')

		}


		function editObject(){

			$.ajax({
	            method: 'POST',
	            url: "${createLink(action:'updateFromStep', controller:'object')}",
	            data:{
	            	id: objectEditingId,
	                name: $('#editObjectName').val(),
	                typeOfMap: 	$('#editObjectTypeOfMap').val(),
	                objId: 	$('#editObjectId').val()
	                },
	             success: function(dataCheck) {
	             	location.reload()
	             },
	             error: function(status, text, result, xhr) {
	                  	$('#newStepErrorMessage').html("Unexpected error")
						$('#newStepErrorModal').modal('show');
	             }
	         });	
		}


		function saveOrder(){
			var text = $('#stepsTable tbody').find('tr')
			var order = ""
			for(var i=0;i<text.length;i++){
				order+=text[i].id
				if(i<text.length-1)
					order+=","
		  	}	
	        	
	       	 $.ajax({
	            method: 'POST',
	            url: "${createLink(action:'saveOrder', controller:'step')}",
	            data:{
	                order: order,
	                id: ${scenarioId},
	                },
	             success: function(dataCheck) {
	             },
	             error: function(status, text, result, xhr) {
	                  	$('#newStepErrorMessage').html("Unexpected error")
						$('#newStepErrorModal').modal('show');
	             }
	         });	
			}

		$(window).load( function(){
			
			notificationsInterval = setInterval(getNotifications, 8000);
			enableSearch()
			makeTablePaginated()
			setZoomImages()

				//Make steps table sortable
				$('#editSupportActions').sortable()
			$("#stepsTable tbody").sortable({
		    	helper: fixHelperModified,
				stop: function(event,ui) {
					renumber_table('#stepsTable')
					saveOrder()
				}
			}).disableSelection();
		})





		$('#selectAllObjects').change(function(){
			if(this.checked) {
				$('.trSelectable').each(function(i, obj) {
					if(!$(this).hasClass("autoGenerated")){
						$(this).css('background-color','#ccd9ff')
						$(this).attr('select','1')
					}
					
				});
			}
			else{
				
					$('.trSelectable').each(function(i, obj) {
						if(!$(this).hasClass("autoGenerated")){
							$(this).css('background-color','')
							$(this).attr('select','0')
						}
					});
				
			}
		})


		$('#selectAllObjectsAuto').change(function(){
			if(this.checked) {
				$('.trSelectable').each(function(i, obj) {
					if($(this).hasClass("autoGenerated")){
						$(this).css('background-color','#ccd9ff')
						$(this).attr('select','1')
					}
					
				});
			}
			else{
				
					$('.trSelectable').each(function(i, obj) {
						if($(this).hasClass("autoGenerated")){
							$(this).css('background-color','')
							$(this).attr('select','0')
						}
					});
				
			}
		})

		$('#selectAllRowsSwitch').change(function(){
			if(this.checked) {
				$('.trSelectableSteps').each(function(i, obj) {
					if($(this).hasClass("autoGenerated")){
						$(this).css('background-color','#ccd9ff')
						$(this).attr('select','1')
					}					
				});
			}
			else{				
				$('.trSelectableSteps').each(function(i, obj) {
					if($(this).hasClass("autoGenerated")){
						$(this).css('background-color','')
						$(this).attr('select','0')
					}
				});				
			}
		})

		$('#expiredSessionModal').on('hidden.bs.modal', function () {
			location.reload()
		})



		$('.trSelectable').click(function(){
			var selected = $(this).attr('select')
			if(selected =="0"){
				$(this).css('background-color','#ccd9ff')
				$(this).attr('select','1')
			}
			else{
				$(this).css('background-color','')
				$(this).attr('select','0')
			}
		})

		$('.trSelectableSteps').click(function(){
			var selected = $(this).attr('select')
			if(selected =="0"){
				$(this).css('background-color','#ccd9ff')
				$(this).attr('select','1')
			}
			else{
				$(this).css('background-color','')
				$(this).attr('select','0')
			}
		})


		function setDeletingId(newId){
			deletingId = newId
			$('#confirmModal').modal('show');
		}

		$('.caretButton').click(function (){
			var result = ""
			$( "#sObjectsTable > tbody > .trSelectable" ).each(function() {
				if($(this).attr('select')=='1'){
					var id = $(this).attr('idobj')
					result+=  ( id  )+"," ;
				}
			});
			$( "#sObjectsTableAuto > tbody > .trSelectable" ).each(function() {
				if($(this).attr('select')=='1'){
					var id = $(this).attr('idobj')
					result+=  ( id  )+"," ;
				}
			});
			if(result!=""){
				$.ajax({
					method: 'POST',
					url: "${createLink(action:'createFromObject', controller:'step')}",
					data:{
						id: ${scenarioId},
						objects:result,
					},
					success: function(dataCheck) {
						location.reload()
					},
					error: function(status, text, result, xhr) {
						alert("error")
					}
				});
			}
		})


		function deleteStep() {
			$.ajax({
				method: "POST",
				url: "${createLink(action:'delete', controller:'step', )}",
				data: { 
					id: deletingId, 
					scenarioId: ${scenarioId}, 
				}, 
				success: function(result) {
					location.reload()
				},
				error: function(status, text, result, xhr) {
					showDeleteErrorModal(status.responseText);
				}
			});
		}

		function masiveDeleteStep() {			
			$.ajax({
				method: "POST",
				url: "${createLink(action:'deleteSteps', controller:'step')}",
				data: { 
					stepsToDelete: stepsToDelete, 
					scenarioId: ${scenarioId}
				},
				success: function(result) {
					location.reload()
				},
				error: function(status, text, result, xhr) {
					showDeleteErrorModal(status.responseText);
				}
			});
		}

		function showDeleteErrorModal(error) {
			$('#confirmModal').modal('hide');
			$('#newStepErrorMessage').html(error)
			$('#newStepErrorModal').modal('show');
		}




		$("#selectAllSwitch").change(function() {
			if(this.checked) {
				$('.enabledcheck').each(function(i, obj) {
					$(this).prop('checked',true)
					$(this).change()
				});
			}
			else{
				$('.enabledcheck').each(function(i, obj) {
					$(this).prop('checked',false)
					$(this).change()
				});
			}
		})

		$("#deleteSelection").click(function() {			
			$("#stepsTable > tbody > .trSelectableSteps").each(function() {
				if($(this).attr('select')=='1'){
					stepsToDelete+=$(this).attr('id')+","
				}
			});
			if(stepsToDelete!=""){
				$("#masiveDeleteConfirmModal").modal('show')
			}	
		})

		$('.caretButton').mousedown(function (){
			$(this).css('color','orange')
		})
		$('.caretButton').mouseup(function (){
			$(this).css('color','green')
		})



		$('#pagesSelectNewStep').change(function(){
			var index = $(this).prop('selectedIndex')-1 
			$('#objectsDropdown').empty()
			$('#objectsDropdown').append('<option value="null" ></option>')
			<g:each in="${pages}" status="i" var="page">
				if(${i}==index){
					<g:each in="${page.objects}" var="obj">						
						if(${associatedScenario.type == 1}){
							if(${obj.pType} == 1 || ${obj.pType} == 2 || ${obj.pType} == 3){
								$('#objectsDropdown').append('<option style="color:#555" id="${obj.id}" value="${obj.id}">${obj.name}</option>')
							}
						}else if(${associatedScenario.type == 2}){
							if(${obj.pType} == 4 || ${obj.pType} == 2 || ${obj.pType} == 3){
								$('#objectsDropdown').append('<option style="color:#555" id="${obj.id}" value="${obj.id}">${obj.name}</option>')
							}
						}else if(${associatedScenario.type == 3}){
							if(${obj.pType} == 5 || ${obj.pType} == 2 || ${obj.pType} == 3){
								$('#objectsDropdown').append('<option style="color:#555" id="${obj.id}" value="${obj.id}">${obj.name}</option>')
							}
						}						
					</g:each>
				}
			</g:each>

		})

	$('#pagesSelect').on('change', function (e) {
		$('#sObjectsTable tbody').empty()
		$('#sObjectsTableAuto tbody').empty()
	    var optionSelected = $(this).val()
	    var valueSelected = this.value;
	    var index = $(this).prop('selectedIndex')
		<g:each in="${pages}" var="page" status="i">
			if(${page.id}==optionSelected){
				<g:if test="${page.objects.sort{it.dateCreated}.findAll{!it.autoGenerated}.size()==0}">
					$("#sObjectsTable.pager").hide()
					$('#selectAllLabel').hide()
					$('#sObjectsTable').hide()

				</g:if>
				<g:else>
					$("#sObjectsTable.pager").show()
					$('#selectAllLabel').show()
					$('#sObjectsTable').show()
				</g:else>
					<g:each in ="${page.objects.sort{it.dateCreated}.findAll{!it.autoGenerated}}" var="obj">
					
						$('#sObjectsTable').append('<tr class="trSelectable"  select="0" idobj="${obj.id}"><td class="notSelectable" style="border:solid 1px  #ccccb3;">${obj.name}</td><td style="border:solid 1px  #ccccb3;"><img class="zoomImage" style="max-height:50px; max-width:150px" original="" src="'+"${createLink(controller: 'stage', action:'renderImage', params:[idOb:obj.imageUrl])}"+'" /></td></tr>')
					</g:each>
					<g:each in ="${page.objects.sort{it.dateCreated}.findAll{it.autoGenerated}}" var="obj">
				
					
						$('#sObjectsTableAuto').append('<tr class="trSelectable autoGenerated"  select="0" idobj="${obj.id}"><td class="notSelectable" style="border:solid 1px  #ccccb3;">${obj.name}</td><td style="border:solid 1px  #ccccb3;"><img class="zoomImage" style="max-height:50px; max-width:150px" original="" src="'+"${createLink(controller: 'stage', action:'renderImage', params:[idOb:obj.imageUrl])}"+'" /></td></tr>')
					</g:each>

				}
		</g:each>

		$('.trSelectable').click(function(){
			var selected = $(this).attr('select')
			if(selected =="0"){
				$(this).css('background-color','#ccd9ff')
				$(this).attr('select','1')
			}
			else{
				$(this).css('background-color','')
				$(this).attr('select','0')
			}
		})
		$('.pager').remove()
		makeTablePaginated()
		if(!$("#sObjectsTable.table").is(":visible")){
			$("#sObjectsTable.pager").hide()
		}
		setZoomImages()
	});

		/*$('tr').mousedown(function(){
			$(this).css('position', 'fixed')
		})
		$('tr').mouseup(function(){
			$(this).css('position', 'relative')
		})*/




		$('#editPagesSelectStep').change(function(){
			var index = $(this).prop('selectedIndex') 
			$('#editObjectsDropdown').empty()
			$('#editObjectsDropdown').append('<option value="null"  name="--" imageUrl="noImage" ></option>')
			<g:each in="${pages}" status="i" var="page">
			if(${i}==index){
				<g:each in="${page.objects.sort{it.dateCreated}}" var="obj">
				<g:if test="${!obj.autoGenerated}">
					$('#editObjectsDropdown').append('<option style="color:#555" id="${obj.id}" value="${obj.id}" name="${obj.name}" typeOfMap="${obj.allTargets.split('#;#')[1]}" imageUrl="${obj.imageUrl}" idObj="${obj.allTargets.split('#;#')[0]}" action="${obj.defaultAction.id}">${obj.name}</option>')
				 </g:if>
				<g:else>
				$('#editObjectsDropdown').append('<option style="color:#555" id="${obj.id}" value="${obj.id}" name="${obj.name}" typeOfMap="${obj.allTargets}" imageUrl="${obj.imageUrl}" idObj="${obj.allTargets}" action="${obj.defaultAction.id}">${obj.name}</option>')
				</g:else>
				
				</g:each>
		}
			</g:each>

	})








		$('#objectsDropdown').change(function(){
			var pType=$('#objectsDropdown option:selected').attr('pType')
			$('#stepType').val(pType)
			$('#actionsDropdown').empty();
			var val = $(this).val()
			if(val!='null')
				var defaultAction = $('#objectsDropdown option:selected').attr('action')
			<g:each in="${actions}" var="action">
				if( val=="null"){
					if(${!action.needsObject}){						
						if(${associatedScenario.type == 1}){
							if(${action.platform.contains('WEB') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
								$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
							}
						} else if(${associatedScenario.type == 2}){
							if(${action.platform.contains('UFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
								$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
							}
						} else if(${associatedScenario.type == 3}){
							if(${action.platform.contains('RFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
								$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
							}
						}						
					}
				}else{	
					if(${associatedScenario.type == 1}){
						if(${action.platform.contains('WEB') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
							$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')		
						}
					} else if(${associatedScenario.type == 2}){
						if(${action.platform.contains('UFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
							$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
						}
					} else if(${associatedScenario.type == 3}){
						if(${action.platform.contains('RFT') || action.platform.contains('GUI') || action.platform.contains('CLI')}){
							$('#actionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changePrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
						}
					}				
				}
			</g:each>
			if(val!='null')
				$('#actionsDropdown').val(defaultAction)
			if($(this).val()=="null"){
				$('#supportActionsDiv').css('display','none')
			}
			else{

				$('#supportActionsDiv').css('display','block')

			}
			$('#isMasive').change()
		})



		$('#editObjectsDropdown').change(function(){

			$('#objectModal'+editingId).text($("option:selected", this).attr('name'))

			var newHref = 'showEditObjectModal('+$("option:selected", this).attr("id")+',"'+$("option:selected", this).attr("name")+'","'+$("option:selected", this).attr("typeOfMap")+'","' + $("option:selected", this).attr("idObj")+'")'
			$('#editSmall'+editingId).attr('object', $(this).val())

			$('#editSmall'+editingId).attr('page', $('#editPagesSelectStep').val())
			var newsrc = "${createLink(controller:'stage', action:'renderImage')}?idOb="+ $("option:selected", this).attr("imageUrl")
			
			$('#referenceImage'+editingId).attr('src',newsrc)

			$('#objectModal'+editingId).attr('onclick',newHref)
			if($("option:selected", this).attr('imageUrl')=='noImage' && $("option:selected", this).attr('name')=='--' ){
				$('#objectModal'+editingId).attr('onclick', 'return false;')
			}
			$('#objectModal'+editingId).text($("option:selected", this).attr('name'))
			$('#editActionsDropdown').empty();
			var val = $(this).val()
			if(val!='null')
				var defaultAction = $('#editObjectsDropdown option:selected').attr('action')
			else{
				var defaultAction = 1;
			}

			<g:each in="${actions}" var="action">
				
				if(${action.id}==defaultAction){
					$('#firstEditActionsLabel').text('${message(code:action.name)}')
					$('#lastEditActionsLabel').text("${action.platform}")
					$('#editActionsDropdown').attr('customhtml', decodeEntities('${action.html.replace("replaceForCode",message(code:action.name))}'))
					$('#editActionsDropdown').attr('value', ${action.id})
					var platform = '${action.platform}'
				}
				<g:if test="${associatedScenario.type == 1 && (action.platform.contains('WEB') || action.platform.contains('GUI') || action.platform.contains('CLI'))}">
					if( val=="null"){
						if(${!action.needsObject}){
							$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changeEditPrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
						}
					}else{					
						$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}"  id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"> <a href="#" onclick="changeEditPrincipalAction(this); return false;" ><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
					}
				</g:if>
				<g:elseif test="${associatedScenario.type == 2 && (action.platform.contains('UFT') || action.platform.contains('GUI') || action.platform.contains('CLI'))}">
					if( val=="null"){
						if(${!action.needsObject}){
							$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changeEditPrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
						}
					}else{					
						$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}"  id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"> <a href="#" onclick="changeEditPrincipalAction(this); return false;" ><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
					}
				</g:elseif>
				<g:elseif test="${associatedScenario.type == 3 && (action.platform.contains('RFT') || action.platform.contains('GUI') || action.platform.contains('CLI'))}">
					if( val=="null"){
						if(${!action.needsObject}){
							$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}" id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"><a href="#" onclick="changeEditPrincipalAction(this); return false;"><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
						}
					}else{					
						$('#editActionsDropdown').append('<li class="select-dropdown-li"  platform="${action.platform}"  id="${action.id}" customhtml='+"'"+'${action.html.replace("replaceForCode",message(code:action.name))}'+"'"+' value="${message(code:action.name)}"> <a href="#" onclick="changeEditPrincipalAction(this); return false;" ><label class="select-dropdown-li-first">'+'${message(code:"${action.name}")}'+'</label><label class="label label-info select-dropdown-li-last" >${action.platform}</label></a></li>')
					}
				</g:elseif>
			</g:each>

		if($(this).val()=="null"){
			$('#editSupportActionsDiv').css('display','none')
		}
		else{
			$('#editSupportActionsDiv').css('display','block')
		}
		if(val!='null')
			$('#editActionsDropdown').attr('value',defaultAction)
			$('#editActionsDropdown').attr('customhtml','')
			$('#editActionsDropdown').change()
			$('#editIsMasive').change()
	})






		$('#isMasive').change(function (){
			if(this.checked){
				var principalTitle ="<h5><b>"+"${message(code:'text.principalAction')}"+"</b></h5>"
				var principalHtml ="<label>"+$('#actionsDropdown option:selected').text()+"</label>"+$('#actionsDropdown option:selected').attr('customhtml')
				var supportTitle=""
				var supportHtml =""
				if($('#supportActions .normalSA').length >0){
					supportTitle = "<h5><b>"+"${message(code:'text.supportActions')}"+"</b></h5>"

					$('#supportActions .normalSA').each(function(){
						supportHtml+="<label>"+$(this).text()+"</label>"+$(this).attr('customhtml')
						if($(this).attr('customhtml').indexOf('form-control')!=-1){
							supportHtml+="<br/>"
						}
					})
				}
				$("#masiveHtml").html(principalTitle+principalHtml+supportTitle+supportHtml+"<br/>")
			}
			else{
				$("#masiveHtml").html('')
			}

		})


		$('#editIsMasive').change(function (){
			if($(this).prop('checked')){
				$('#editSmall'+editingId).attr('isMasive', 'true')
			}
			else{
				$('#editSmall'+editingId).attr('isMasive', 'false')
			}
			if(mustUpdate)
				updateStep()
				if(this.checked){
				editPrincipalHtml = $('#editActionsDropdown').attr('customhtml')
				for(var l=0;l<editPrincipalValues.length;l++){
					var curValues = editPrincipalValues[l].split('#;#')
					if(curValues.length>l){
						for(var j=0;j<curValues.length;j++){
							if(editPrincipalHtml.indexOf('<input')>-1){
								editPrincipalHtml=editPrincipalHtml.replace('value=""','value="'+curValues[j]+'"')
							}
						}
					}

				}


				var principalTitle ="<h5 style='padding-top:10px'><b>"+"${message(code:'text.principalAction')}"+"</b></h5>"
				var principalHtml ="<label style='padding-left:10px; color: rgb(15,35,37)'>"+$('#firstEditActionsLabel').text()+"</label>"+decodeEntities(editPrincipalHtml)
				


				var supportTitle=""
				var supportHtml =""
				if($('#editSupportActions .editSA').length >0){
					supportTitle = "<h5><b>"+"${message(code:'text.supportActions')}"+"</b></h5>"

					$('#editSupportActions .editSA').each(function(){
						supportHtml+="<label style='padding-left:10px'>"+$(this).text()+"</label>"+$(this).attr('customhtml')
						if(supportHtml.indexOf('small')!=-1){
							supportHtml+="<br/>"
						}
					})
				}
				$("#editMasiveHtml").html(principalTitle+principalHtml+supportTitle+supportHtml+"<br/>")
			}
			else{
				$("#editMasiveHtml").html('')
			}
			
			

		})


		$('#actionsDropdown').change(function(){
			$('#isMasive').change()
		})


		$('#editActionsDropdown').change(function(){
			$('#editIsMasive').change()
			
		})



		function removeAction(action){
			var id= $(action).attr('id')
			console.log(id)
			var counter = 0
			var tipo = 0
			$('#tdsupport'+editingId+" .label").each(function(){
				
				if(counter>0){
					if(counter%2==1){
						
						if(tipo==1){
							$(this).attr('class','')
							$(this).addClass('label label-success col-md-5  col-xs-5  col-sm-5')
							$(this).css('margin-top', '1px')
							$(this).css('margin-bottom', '1px')
							$(this).css('margin-left', '4px')
							$(this).css('margin-right', '3px')
						}
						else{
							$(this).attr('class','')
							$(this).addClass('label label-success col-md-5 col-xs-5 col-sm-5')
							$(this).css('margin-left', '')
							$(this).css('margin-right', '')
							
						}
					}
					else{
						if(tipo==0){
							$(this).attr('class','')
							$(this).addClass('label label-success col-md-5  col-xs-5 col-sm-5 ')
							$(this).css('margin-top', '1px')
							$(this).css('margin-bottom', '1px')
							$(this).css('margin-left', '4px')
							$(this).css('margin-right', '3px')
						}
						else{
							$(this).attr('class','')
							$(this).addClass('label label-success col-md-5 col-xs-5 col-sm-5')
							$(this).css('margin-left', '')
							$(this).css('margin-right', '')
							
						}
					
					}
					counter++
				}

				if($(this).attr('id')==id){
					counter=1;
					if($(this).css('margin-left')=='4px'){
						tipo = 1;
					}
					$(this).remove()
				}
			})

			$(action).closest( "li" ).remove()
			updateStep()
			if($('#editSupportActions > li').size()==0){
				$('#editNotSupportActionsAdded').show()
			}
			if($('#supportActions > li').size()==0){
				$('#notSupportActionsAdded').show()
			}
			$('#isMasive').change()
		}


		function updateStep(){
			var text = $('#editSupportActions').find('.editSA')
			var supportActions =""
			for(var i=0;i<text.length;i++){
				supportActions+=text[i].title
				if(i<text.length-1)
					supportActions+=","
			}
			var counter =0;
			var H5Counter =0;
			var principalValue=""
			var supportValues=""
			$('#editMasiveHtml').children().each(function(){
				if($(this).prop('tagName')=='H5'){
					H5Counter++;
				}
				if(H5Counter>1){
					if($(this).prop('tagName') =='INPUT'){
						supportValues+=$(this).val()+"#;#"
					}
					else if($(this).prop('tagName')=='SMALL'){
						supportValues+=$(this).text()+"#;#"
					}
					else if($(this).prop('tagName')=='LABEL'){
						supportValues+="&&"
					}

				}
				else{
					if($(this).prop('tagName')=='INPUT'){
						principalValue+=$(this).val()+"#;#"
					}
					else if($(this).prop('tagName')=='SMALL'){
						principalValue+=$(this).text()+"#;#"
					}
				}

				counter++;

			})
			var object=$('#editObjectsDropdown option:selected').val()
			var principalAction =$('#editActionsDropdown').attr('value')			
			var pType =$('#editStepType option:selected').val()
			if(pType == null){
				if($("#lastEditActionsLabel").text().indexOf('WEB') > -1){
					pType = "1"
				}else if($("#lastEditActionsLabel").text().indexOf('GUI') > -1){
					pType = "2"
				}else if($("#lastEditActionsLabel").text().indexOf('CLI') > -1){
					pType = "3"
				}else if($("#lastEditActionsLabel").text().indexOf('UFT') > -1){
					pType = "4"
				}else if($("#lastEditActionsLabel").text().indexOf('RFT') > -1){
					pType = "5"
				}
			}
			var isMasive = $('#editIsMasive').prop('checked')
			var mustTakeScreenShot = $('#editMustTakeScreenshot').prop('checked')
			var mustTakeLocalScreenShot = $('#editMustTakeLocalScreenshot').prop('checked')
			var isHidden = $('#editIsHidden').prop('checked')
			var forceCoordinates = $('#editForceCoordinates').prop('checked')
			var enabled = $('#editEnabled').prop('checked')



			$.ajax({
				method: 'POST',
				url: "${createLink(action:'update', controller:'step')}",
				data:{
					supportActions: supportActions,
					id: editingId,
					object:object,
					pType:pType,
					principalAction:principalAction,
					mustTakeScreenShot:mustTakeScreenShot,
					mustTakeLocalScreenShot:mustTakeLocalScreenShot,
					forceCoordinates:forceCoordinates,
					isEnabled:enabled,
					isMasive:isMasive,
					isHidden:isHidden,
					principalValue:principalValue,
					supportValues:supportValues,
				},
				success: function(status, text, result, xhr) {
					if(mustUpdate){
						$('#editSmall'+editingId).attr('supportActions', JSON.parse(result.responseText).supportActions)
						$('#editSmall'+editingId).attr('principalValue', JSON.parse(result.responseText).principalValue)
						console.log(JSON.parse(result.responseText))
					}
				},
				error: function(status, text, result, xhr) {
					
					$('#newStepErrorMessage').html(status.responseText)
					$('#newStepErrorModal').modal('show');
				}
			});

		}


		$('#editStepButton').click(function() {
			updateStep()
		});



	$('.enabledcheck').change(function(){
		var id=$(this).attr('id')
		var state = $(this).prop('checked')
		$.ajax({
				method: 'POST',
				url: "${createLink(action:'setEnabled', controller:'step')}",
				data:{
					state: state,
					id: id
				},
				success: function(dataCheck) {
					$('#editSmall'+id).attr("isEnabled", state)
				},
				error: function(status, text, result, xhr) {
					location.reload()
				}
			});

	})



	function showEditStepModal(id)
	{

		editingId=id
		$('#editPagesSelectStep').val($('#editSmall'+id).attr('page'))
		$('#editPagesSelectStep').change()
	

		var principalValues = $('#editSmall'+id).attr('principalValue').split('&&')
		editPrincipalValues = principalValues

		$('#editObjectsDropdown').val($('#editSmall'+id).attr('object'))
		$('#editObjectsDropdown').change()
		<g:each in="${actions}" var="action">
			if(${action.id}==$('#editSmall'+id).attr('principalAction')){
				
					$('#firstEditActionsLabel').text('${message(code:action.name)}')
					$('#lastEditActionsLabel').text("${action.platform}")
					$('#editActionsDropdown').attr('customhtml', '${action.html.replace("replaceForCode",message(code:action.name))}')
					$('#editActionsDropdown').attr('value', ${action.id})
					var platform = '${action.platform}'
				
			}
		</g:each>


		var principalHtml=$('#editActionsDropdown option:selected').attr('customhtml')
		if(!principalHtml)
			principalHtml=""
		for(var l=0;l<principalValues.length;l++){
			var curValues = principalValues[l].split('#;#')
			if(curValues.length>l){
				for(var j=0;j<curValues.length;j++){
					if(principalHtml.indexOf('<input')>-1){
						principalHtml=principalHtml.replace('value=""','value="'+curValues[j]+'"')
					}
				}
			}

		}
		editPrincipalHtml = principalHtml
	
		if($('#editSmall'+id).attr('mustTakeScreenShot')=="true"){
			$('#editMustTakeScreenshot').prop('checked',true)
		}
		else{
			$('#editMustTakeScreenshot').prop('checked',false)
		}

		if($('#editSmall'+id).attr('mustTakeLocalScreenShot')=="true"){
			$('#editMustTakeLocalScreenshot').prop('checked',true)
		}
		else{
			$('#editMustTakeLocalScreenshot').prop('checked',false)
		}


		if($('#editSmall'+id).attr('isEnabled')=="true"){
			$('#editEnabled').prop('checked',true)
		}
		else{
			$('#editEnabled').prop('checked',false)
		}

		

		if($('#editSmall'+id).attr('isHidden')=="true"){
			$('#editIsHidden').prop('checked',true)
		}
		else{
			$('#editIsHidden').prop('checked',false)	
		}

		if($('#editSmall'+id).attr('forceCoordinates')=="true"){
			$('#editForceCoordinates').prop('checked',true)

		}
		else{
			$('#editForceCoordinates').prop('checked',false)
		}


	
		$('#editStepType').val($('#editSmall'+id).attr('pType'))

		
		var support=JSON.parse($('#editSmall'+id).attr('supportActions'))

		var html =""
				for(var k=0;k<support.length;k++){
			var message=""
			jQuery.ajax({
				type:'POST',
				data:'name='+support[k].name, 
				async:false,
				url: "${createLink(action:'findMessage', controller:'step')}",
				success: function(data,textStatus){
					message=data
					var supportValues = $('#editSmall'+id).attr('supportValues').split('&&')
					var customHtmls =[]
					for(var l=0;l<support.length;l++){
						var customHtml = support[l].html
						if(supportValues.length>l){
							var curSupportValues = supportValues[l].split('#;#')
		 
							for(var j=0;j<curSupportValues.length;j++){
								if(customHtml.indexOf('<input')>-1){
									customHtml=customHtml.replace('value=""','value="'+curSupportValues[j]+'"')
								}
							}
						}
		 
						customHtmls[l]=customHtml.replace('replaceForCode',message)			}
		 
		 
					html+= '<li class="" style=""><span class="handle ui-sortable-handle">'+
					'<i class="fa fa-ellipsis-v"></i> <i class="fa fa-ellipsis-v"></i>'+
					'</span> <span title="'+support[k].id+'" class="text editSA" customhtml='+"'"+customHtmls[k]+"'"+"><g:message code='"+message+"'/>"+'</span><div class="tools"><i id="'+support[k].id+'" class="fa fa-trash action-trash" onclick="removeAction(this)"></i> </div></li>'

				},error:function(XMLHttpRequest,textStatus,errorThrown){
 
 
				}
			});
			
		}
	
			if(html.length == 0){
				$('#editNotSupportActionsAdded').show()
			}
		
		$('#editSupportActions').html(html)
		$('#editStepModal').modal('show')
		
		var platform = $('#editSelectSupportActions li').first().attr('platform')
		var newText = $('#editSelectSupportActions li').first().attr('value')
		var actionValue = $('#editSelectSupportActions li').first().attr('id')
		var customHtml = $('#editSelectSupportActions li').first().attr('customhtml')
		
		$('#firstEditSupportActionsLabel').text(newText)
		$('#lastEditSupportActionsLabel').text(platform)
		$('#editSelectSupportActions').attr('customhtml', customHtml)
		$('#editSelectSupportActions').attr('value', actionValue)

	}


	$('#editStepModal').on('shown.bs.modal', function(){
		if($('#editSmall'+editingId).attr('isMasive')=="true"){
			$('#editIsMasive').prop('checked',true)
			
		}
		else{
			$('#editIsMasive').prop('checked',false)

		}
		$('#editIsMasive').change()
		mustUpdate=true
	});
	
	$('#editStepModal').on('hidden.bs.modal', function(){
		$('#notPosibleToAdd').css('display','none')
		$('#editIsMasive').change()
		mustUpdate=false
	});





	function addNewSupportAction(ul){
			if($('#selectSupportActions').attr('value')!=''){

			var platform = $('#lastSupportActionsLabel').text()
			var selectedAction = $('#firstSupportActionsLabel').text()
			var selectedActionVal = $('#selectSupportActions').attr('value')
			var customHtml =$('#selectSupportActions').attr('customhtml').replace('replaceForCode', selectedActionVal)

			 var isPosibleToAdd = true;
			 $('#supportActions li').each(function(){
			 	if($(this).attr('id')==selectedActionVal){
			 		isPosibleToAdd=false;
			 	}
			 })
			
			if(isPosibleToAdd){
				$('#notSupportActionsAdded').hide()
				$('#newNotPosibleToAdd').css('display','none')
				var html= '<li class="" style="" id="'+selectedActionVal+'"><span class="handle ui-sortable-handle">'+
				'<i class="fa fa-ellipsis-v"></i> <i class="fa fa-ellipsis-v"></i>'+
				'</span> <span title="'+selectedActionVal+'"class="text' 

				if(ul.indexOf("edit") > -1){
					html+=' editSA" customhtml='+"'"+customHtml+"'"+'>'+selectedAction+'</span><div class="tools"><i class="fa fa-trash action-trash"  style="color:red" id="'+selectedActionVal+'" onclick="removeAction(this)"></i> </div></li>'

				}
				else{
					html+=' normalSA" customhtml='+"'"+customHtml+"'"+'>'+selectedAction+'</span><div class="tools"><i class="fa fa-trash action-trash" style="color:red"  id="'+selectedActionVal+'" onclick="removeAction(this)"></i> </div></li>'
				}
				
				$(ul).append( html );
				$('#isMasive').change()  
		
			}
			else{
				$('#newNotPosibleToAdd').css('display','block')
			}
			return false;
		}
		
	}



	function addSupportAction(ul){
		 if($('#editSelectSupportActions').attr('value')!=''){
		var actualSupportCount = $('#tdsupport'+editingId+" .label").length


		var platform = $('#lastEditSupportActionsLabel').text()
		var selectedAction = $('#firstEditSupportActionsLabel').text()
		var selectedActionVal = $('#editSelectSupportActions').attr('value')
		var customHtml =$('#editSelectSupportActions').attr('customhtml').replace('replaceForCode', selectedActionVal)

		 var isPosibleToAdd = true;
		 $('#tdsupport'+editingId+" .label").each(function(){
		 	if($(this).attr('id')==selectedActionVal){
		 		isPosibleToAdd=false;
		 	}
		 })
		
		if(isPosibleToAdd){
			$('#editNotSupportActionsAdded').hide()
			$('#notPosibleToAdd').css('display','none')
			var html= '<li class="" style=""><span class="handle ui-sortable-handle">'+
			'<i class="fa fa-ellipsis-v"></i> <i class="fa fa-ellipsis-v"></i>'+
			'</span> <span title="'+selectedActionVal+'"class="text' 

			if(ul.indexOf("edit") > -1){
				html+=' editSA" customhtml='+"'"+customHtml+"'"+'>'+selectedAction+'</span><div class="tools"><i class="fa fa-trash action-trash"  style="color:red" id="'+selectedActionVal+'" onclick="removeAction(this)"></i> </div></li>'

			}
			else{
				html+=' normalSA" customhtml='+"'"+customHtml+"'"+'>'+selectedAction+'</span><div class="tools"><i class="fa fa-trash action-trash" style="color:red"  id="'+selectedActionVal+'" onclick="removeAction(this)"></i> </div></li>'
			}
			
			$(ul).append( html );
			$('#editIsMasive').change()    	
			updateStep(editingId)
			selectedAction = selectedAction.trim().length>10?selectedAction.trim().substring(0,7)+'...':selectedAction
			if(actualSupportCount%2 == 0){
				 $('#tdsupport'+editingId).append('<small class="label label-success col-md-5 col-xs-5 col-sm-5" style="margin-top:1px; margin-bottom:1px;" id="'+selectedActionVal+'">'+selectedAction+"</small>")
			}
			else{
				 $('#tdsupport'+editingId).append('<small class="label label-success col-md-5 col-xs-5  col-sm-5 " style="margin-top:1px; margin-bottom:1px;margin-right:1px;margin-left:3px" id="'+selectedActionVal+'">'+selectedAction+"</small>")
			}
			$('#editSelectSupportActions').attr('value','')
			$('#firstEditSupportActionsLabel').text('')
			$('#lastEditSupportActionsLabel').text('')
	
		}
		else{
			$('#notPosibleToAdd').css('display','block')
		}
		return false;
		
	}
}



	$('#formNewStepButton').click(function() {

			var text = $('#supportActions').find('.normalSA')
			var supportActions =""
			for(var i=0;i<text.length;i++){
				supportActions+=text[i].title
				if(i<text.length-1)
					supportActions+=","
			}
			var counter =0;
			var H5Counter =0;
			var principalValue=""
			var supportValues=""
			$('#masiveHtml').children().each(function(){
				if($(this).prop('tagName')=='H5'){
					H5Counter++;
				}
				if(H5Counter>1){
					if($(this).prop('tagName') =='INPUT'){
						supportValues+=$(this).val()+"#;#"
					}
					else if($(this).prop('tagName')=='SMALL'){
						supportValues+=$(this).text()+"#;#"
					}
					else if($(this).prop('tagName')=='LABEL'){
						supportValues+="&&"
					}

				}
				else{
					if($(this).prop('tagName')=='INPUT'){
						principalValue+=$(this).val()+"#;#"
					}
					else if($(this).prop('tagName')=='SMALL'){
						principalValue+=$(this).text()+"#;#"
					}
				}

				counter++;

			})
			var object=$('#objectsDropdown option:selected').val()
			var pType=$('#stepType option:selected').val()
			var principalAction =$('#actionsDropdown').attr('value')
			var isMasive = $('#isMasive').prop('checked')
			var mustTakeScreenShot = $('#mustTakeScreenshot').prop('checked')
			var mustTakeLocalScreenShot = $('#mustTakeLocalScreenshot').prop('checked')
			var isHidden = $('#isHidden').prop('checked')
			var forceCoordinates = $('#forceCoordinates').prop('checked')
			var enabled = $('#enabled').prop('checked')
			$.ajax({
				method: 'POST',
				url: "${createLink(action:'create', controller:'step')}",
				data:{
					supportActions: supportActions,
					id: ${scenarioId},
					object:object,
					pType:pType,
					principalAction:principalAction,
					mustTakeScreenShot:mustTakeScreenShot,
					mustTakeLocalScreenShot:mustTakeLocalScreenShot,
					forceCoordinates:forceCoordinates,
					isEnabled:enabled,
					isMasive:isMasive,
					isHidden:isHidden,
					principalValue:principalValue,
					supportValues:supportValues,
				},
				success: function(dataCheck) {
					location.reload()
				},
				error: function(status, text, result, xhr) {
					
					$('#newStepErrorMessage').html(status.responseText)
					$('#newStepErrorModal').modal('show');
				}
			});

		});

		function getBrowsers(id){
			$.ajax({
				method: 'POST',
				url: "${createLink(action:'getBrowsers', controller:'user')}",
				data:{
					id:id
				},
				
				success: function(result) {
					console.log('success: '+result)

					userBrowsers = result
					console.log('userBrowsers: '+userBrowsers)
					if(result.indexOf('CH')==-1){
						$('#divch').css('display', 'none')
					}
					if(result.indexOf('FF')==-1){
						$('#divff').css('display', 'none')
					}
					if(result.indexOf('IE')==-1){
						$('#divie').css('display', 'none')
					}
					if(result.indexOf('ED')==-1){
						$('#dived').css('display', 'none')
					}
					if(result.indexOf('SA')==-1){
						$('#divsa').css('display', 'none')
					}
					if(result.indexOf('OP')==-1){
						$('#divop').css('display', 'none')
					}
					$("#checkch").prop("checked", false);
					$("#checkff").prop("checked", false);
					$("#checkie").prop("checked", false);
					$("#checksa").prop("checked", false);
					$("#checked").prop("checked", false);
					$("#checkop").prop("checked", false);
					webScenario = id
					console.log('browsers: '+userBrowsers)
					$('#browserSelectionModal').modal('show')
				},
				error: function(status, text, result, xhr) {
						$("#executionErrorMessage").html(status.responseText)
						$("#executionErrorModal").modal('show')
				}
				
			});

		}



		function showBrowsers(id){
			getBrowsers(id)
			
			
		}

		function executeWebScenario(){
				
				var browsers =""
				if($('#checkch').prop('checked')){
					browsers+='CH,'}
				if($('#checkff').prop('checked')){
					browsers+='FF,'}
				if($('#checkie').prop('checked')){
					browsers+='IE,'}
				if($('#checksa').prop('checked')){
					browsers+='SA,'}
				if($('#checked').prop('checked')){
					browsers+='ED,'}
				if($('#checkop').prop('checked')){
					browsers+='OP,'}
				if(browsers!=""){
					$('#browserSelectionModal').modal('hide')
					$.ajax({
					   url: "${createLink(action:'executeWebScenario', controller:'execution')}",
					   method:"POST",
					data:{ id: webScenario,
							browsers: browsers,
							forced: false,
						},
					success : function(result, status) {
						if(result=="queue"){
							$('#executionSuccessMessage').html("${message(code:'scenario.execution.queued')}")
							$('#executionSuccessModal').modal('show');
							setTimeout(function(){
  								$('#executionSuccessModal').modal('hide')
							}, 3400)
						}
						else if(result=="direct") {
							$('#executionSuccessMessage').html("${message(code:'scenario.execution.direct')}")
							$('#executionSuccessModal').modal('show');
							setTimeout(function(){
  								$('#executionSuccessModal').modal('hide')
							}, 3400)
						}
						else if(result=="confirm"){
							oldBrowsers = browsers
							oldExecutingId=webScenario
							oldExecutionType=1
							$('#forceExecutionModal').modal('show')
						}
						else if(result.indexOf("directWithExtractors")>-1){
								executionType = "direct"
								$('#executionSuccessMessage').html("${message(code:'execution.extractingData')}")
								$('#executionSuccessModal').modal('show');

								curExecutionRequestId = result.substring(result.indexOf(":")+1)
								executionResponseInterval = setInterval(checkExecutionResponse, 600);
						}
						else if(result.indexOf("queueWithExtractors")>-1){
								executionType = "queue"
								$('#executionSuccessMessage').html("${message(code:'execution.extractingData')}")
								$('#executionSuccessModal').modal('show');

								curExecutionRequestId = result.substring(result.indexOf(":")+1)
								executionResponseInterval = setInterval(checkExecutionResponse, 600);
						}
					},error: function(status, text, result, xhr){
							$("#executionErrorMessage").html(status.responseText)
							$("#executionErrorModal").modal('show')
							}
				});
				}
				 
			}



			function forceExecution(){
				$('#forceExecutionModal').modal('hide')
				if(oldExecutionType==1){
					$.ajax({
					   url: "${createLink(action:'executeWebScenario', controller:'execution')}",
					   method:"POST",
					data:{ id: oldExecutingId,
							browsers: browsers,
							forced: true,
						},
						success : function(result, status) {
							if(result=="queue"){
								$('#executionSuccessMessage').html("${message(code:'scenario.execution.queued')}")
								$('#executionSuccessModal').modal('show');
							}
							else if(result=="direct") {
								$('#executionSuccessMessage').html("${message(code:'scenario.execution.direct')}")
								$('#executionSuccessModal').modal('show');
							}
						},
						error: function(status, text, result, xhr){
							$("#executionErrorMessage").html(status.responseText)
							$("#executionErrorModal").modal('show')
							}
					});

				}
				if(oldExecutionType==2){
					$.ajax({
					   url: "${createLink(action:'executeScenario', controller:'execution')}",
					   method:"POST",
					data:{ id: oldExecutingId,
							forced: true,
						},
						success : function(result, status) {
							if(result=="queue"){
								$('#executionSuccessMessage').html("${message(code:'scenario.execution.queued')}")
								$('#executionSuccessModal').modal('show');
							}
							else if(result=="direct") {
								$('#executionSuccessMessage').html("${message(code:'scenario.execution.direct')}")
								$('#executionSuccessModal').modal('show');
							}
						},
						error: function(status, text, result, xhr){
							$("#executionErrorMessage").html(status.responseText)
							$("#executionErrorModal").modal('show')
							}
					});

				}
				
			}

		
			function executeScenario(id){
				 $.ajax({
					   url: "${createLink(action:'executeScenario', controller:'execution')}",
					   method:"POST",
					data:{ id: id,
						forced:false},
					success : function(result, status) {
						if(result=="queue"){
							('#executionSuccessMessage').html("${message(code:'scenario.execution.queued')}")
							$('#executionSuccessModal').modal('show');
						}
						else if(result=="direct") {
							$('#executionSuccessMessage').html("${message(code:'scenario.execution.direct')}")
							$('#executionSuccessModal').modal('show');
						}
						else if(result=="confirm"){
							oldExecutingId=webScenario
							oldExecutionType=2
							$('#forceExecutionModal').modal('show')
						}
					},
					error: function(status, text, result, xhr){
						$("#executionErrorMessage").html(status.responseText)
						$("#executionErrorModal").modal('show')
						}
				});
			}	

			$('.modal').on('hidden.bs.modal', function() {
			$("body").css('padding-right','0px')
		})

//Eventos de auto reloading

$('#editEnabled').change(function(){
	if($(this).prop('checked')){
		$('#'+editingId+'.enabledcheck').prop('checked',true)
		$('#editSmall'+editingId).attr('isEnabled', 'true')
	}
	else{
		$('#'+editingId+'.enabledcheck').prop('checked',false)
		$('#editSmall'+editingId).attr('isEnabled', 'false')
	}
	updateStep()
})


$('#editMustTakeScreenshot').change(function(){
	if($(this).prop('checked')){
		$('#editSmall'+editingId).attr('mustTakeScreenShot', 'true')
		$('#camera'+editingId).css('display','block')
	}
	else{
		$('#editSmall'+editingId).attr('mustTakeScreenShot', 'false')
		$('#camera'+editingId).css('display','none')
	}
	updateStep()
})

$('#editMustTakeLocalScreenshot').change(function(){
	if($(this).prop('checked')){
		$('#editSmall'+editingId).attr('mustTakeLocalScreenShot', 'true')
	}
	else{
		$('#editSmall'+editingId).attr('mustTakeLocalScreenShot', 'false')
	}
	updateStep()
})

$('#editForceCoordinates').change(function(){

	if($(this).prop('checked')){
		$('#editSmall'+editingId).attr('forceCoordinates', 'true')
		
	}
	else{
		$('#editSmall'+editingId).attr('forceCoordinates', 'false')
		
	}
	updateStep()
})

$('#editIsHidden').change(function(){
	if($(this).prop('checked')){
		$('#editSmall'+editingId).attr('isHidden', 'true')
	}
	else{
		$('#editSmall'+editingId).attr('isHidden', 'false')
	}
	updateStep()
})

$('#editStepType').change(function(){
	$('#editSmall'+editingId).attr('pType', $(this).val())
	$('#stepType'+editingId).removeClass('label-danger').removeClass('label-success').removeClass('label-warning')
	if($(this).val()==1){

		$('#stepType'+editingId).text('WEB')
		$('#stepType'+editingId).addClass('label-success')
	}
	else if($(this).val()==2){
		$('#stepType'+editingId).text('GUI')
		$('#stepType'+editingId).addClass('label-warning')
	}
	else if($(this).val()==3){
		$('#stepType'+editingId).text('CLI')
		$('#stepType'+editingId).addClass('label-danger')
	}
	else if($(this).val()==4){
		$('#stepType'+editingId).text('UFT')
		$('#stepType'+editingId).addClass('label-danger')
	}
	else if($(this).val()==5){
		$('#stepType'+editingId).text('RFT')
		$('#stepType'+editingId).addClass('label-danger')
	}
	
	updateStep()
})


$('.btn-group').on('hidden.bs.dropdown', function(){
	$('.select-dropdown-principal-button').css('border-color', '#d2d6de')
	$('.select-dropdown-principal-button').css('border-right-color', '#adadad')
})
$('.btn-group').on('shown.bs.dropdown', function(){
	$('.select-dropdown-principal-button').css('border-color', '#d2d6de')
	$('.select-dropdown-principal-button').css('border-right-color', '#adadad')
})


function checkExecutionResponse(){
	$.ajax({
			url: "${createLink(action:'checkExecutionResponse', controller:'extractor')}",
			method:"POST",
			data:{
				id: curExecutionRequestId,
			},
			success : function(result, status) {
				if(result=="true"){
					clearInterval(executionResponseInterval)
					if(executionType=="queue"){
						$('#executionSuccessMessage').html("${message(code:'scenario.execution.queued')}")
						$('#executionSuccessModal').modal('show');
					}
					else if(executionType=="direct") {

						$('#executionSuccessMessage').html("${message(code:'scenario.execution.direct')}")
					}

				}
				else if(result.indexOf("ERROR")>-1)
				{
					$('#executionSuccessModal').modal('hide');
					clearInterval(executionResponseInterval)
					$('#executionErrorMessage').html(result)
					$('#executionErrorModal').modal('show')
				}
			},
			error: function(status, text, result, xhr){
						alert("Unexpected error")
			}
	})
}

function changeEditPrincipalAction(element){
	if(mustUpdate){
		var platform = $(element).closest('li').attr('platform')
		var newText = $(element).closest('li').attr('value')
		var actionValue = $(element).closest('li').attr('id')
		var customHtml = $(element).closest('li').attr('customhtml')
		if(platform.indexOf(',')!=-1){
			if(platform.indexOf('WEB')!=-1){
				if(${associatedScenario.type} == 1){
					$('#editStepType').val(1)
				}
				else if(${associatedScenario.type} == 2){
					$('#editStepType').val(4)
				}
				else if(${associatedScenario.type} == 3){
					$('#editStepType').val(5)
				}
			}
			else if(platform.indexOf('GUI')!=-1){
				$('#editStepType').val(2)
			}
			else{
				$('#editStepType').val(3)
			}
		}
		else{
			if(platform.indexOf('WEB')!=-1){
				if(${associatedScenario.type} == 1){
					$('#editStepType').val(1)
				} else if(${associatedScenario.type} == 2){
					$('#editStepType').val(4)
				} else if(${associatedScenario.type} == 3){
					$('#editStepType').val(5)
				}				
			}
			else if(platform.indexOf('GUI')!=-1){
				$('#editStepType').val(2)
			}
			else if(platform.indexOf('UFT')!=-1){
				$('#editStepType').val(4)
			}
			else if(platform.indexOf('RFT')!=-1){
				$('#editStepType').val(5)
			}
			else{
				$('#editStepType').val(3)
			}
		}
		$('#editStepType').change()
		$('#editSmall'+editingId).text(newText)
		$('#firstEditActionsLabel').text(newText)
		$('#lastEditActionsLabel').text(platform)
		$('#editSmall'+editingId).attr('principalAction',actionValue)
		$('#editActionsDropdown').attr('customhtml', decodeEntities(customHtml))
		$('#editActionsDropdown').attr('value', actionValue)
	}			
	$('#editIsMasive').change()
	return false;
}











function changeEditSupportAction(element){
	if(mustUpdate){
		var platform = $(element).closest('li').attr('platform')
		var newText = $(element).closest('li').attr('value')
		var actionValue = $(element).closest('li').attr('id')
		var customHtml = $(element).closest('li').attr('customhtml')
		
		$('#firstEditSupportActionsLabel').text(newText)
		$('#lastEditSupportActionsLabel').text(platform)
		$('#editSelectSupportActions').attr('customhtml', customHtml)
		$('#editSelectSupportActions').attr('value', actionValue)
	}
			
	$('#editIsMasive').change()
	return false;
}

var decodeEntities = (function() {
  // this prevents any overhead from creating the object each time
  var element = document.createElement('div');

  function decodeHTMLEntities (str) {
    if(str && typeof str === 'string') {
      // strip script/html tags
      str = str.replace(/<script[^>]*>([\S\s]*?)<\/script>/gmi, '');
      str = str.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gmi, '');
      element.innerHTML = str;
      str = element.textContent;
      element.textContent = '';
    }

    return str;
  }

  return decodeHTMLEntities;
})();



function changePrincipalAction(element){
		var platform = $(element).closest('li').attr('platform')
		var newText = $(element).closest('li').attr('value')
		var actionValue = $(element).closest('li').attr('id')
		var customHtml = $(element).closest('li').attr('customhtml')
		if(platform.indexOf(',')!=-1){
			if(platform.indexOf('WEB')!=-1){
				$('#stepType').val(1)
			}
			else if(platform.indexOf('GUI')!=-1){
				$('#stepType').val(2)
			}
			else{
				$('#stepType').val(3)
			}
		}
		else{
			if(platform.indexOf('WEB')!=-1){
				$('#stepType').val(1)
			}
			else if(platform.indexOf('GUI')!=-1){
				$('#stepType').val(2)
			}
			else{
				$('#stepType').val(3)
			}
		}
		$('#firstActionsLabel').text(newText)
		$('#lastActionsLabel').text(platform)
		$('#actionsDropdown').attr('customhtml', decodeEntities(customHtml))
		$('#actionsDropdown').attr('value', actionValue)

	return false;
}



function changeSupportActions(element){
		var platform = $(element).closest('li').attr('platform')
		var newText = $(element).closest('li').attr('value')
		var actionValue = $(element).closest('li').attr('id')
		var customHtml = $(element).closest('li').attr('customhtml')
		
		$('#firstSupportActionsLabel').text(newText)
		$('#lastSupportActionsLabel').text(platform)
		$('#selectSupportActions').attr('customhtml', customHtml)
		$('#selectSupportActions').attr('value', actionValue)
	
			
	$('#isMasive').change()
	return false;
}


	var platform = $('#actionsDropdown li').first().attr('platform')
	var newText = $('#actionsDropdown li').first().attr('value')
	var actionValue = $('#actionsDropdown li').first().attr('id')
	var customHtml = $('#actionsDropdown li').first().attr('customhtml')
		
	$('#firstActionsLabel').text(newText)
	$('#lastActionsLabel').text(platform)
	$('#actionsDropdown').attr('customhtml', customHtml)
	$('#actionsDropdown').attr('value', actionValue)


	 platform = $('#selectSupportActions li').first().attr('platform')
	 newText = $('#selectSupportActions li').first().attr('value')
	 actionValue = $('#selectSupportActions li').first().attr('id')
	 customHtml = $('#selectSupportActions li').first().attr('customhtml')
		
	$('#firstSupportActionsLabel').text(newText)
	$('#lastSupportActionsLabel').text(platform)
	$('#selectSupportActions').attr('customhtml', customHtml)
	$('#selectSupportActions').attr('value', actionValue)




	</script>
</div>